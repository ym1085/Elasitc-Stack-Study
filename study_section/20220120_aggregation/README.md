---
paginate: true
marp: true
title: marp slide
backgroundColor: ##00BFFF
backgroundImage: url('https://marp.app/assets/hero-background.jpg')
_class: lead
---

## Elastic Stack 4th 집계 스터디

> 엘라스틱 스택의 핵심 기술인 집계를 제대로 분석

---

## 목차

- 엘라스틱서치: 집계
	- 집계의 요청: 응답 형태
	- 메트릭 집계
	- 버킷 집계
	- 집계의 조합
	- 파이프라인 집계
	- 정리

---

## ✔ 1-1 엘라스틱서치: 집계

### 엘라스틱서치의 집계란?

- 데이터를 그룹핑(Grouping)하고 통계값을 얻는 기능이다
- RDB SQL의 GROUPBY와 통계 함수를 포함하는 개념이다

### 엘라스틱서치의 집계 예시

- 데이터를 날짜별로 묶거나 특정 카테고리별로 묶어 그룹별 통계를 작성한다

---

## ✔ 1-2 엘라스틱서치: 집계

### 집계 기능의 효과

- 엘라스틱서치의 검색 기능과 맞물려 엘라스틱서치를 고성능 집계 엔진으로 활용하게 만든다
- 대표적인 활용 사례로는 키바나( 데이터 시각화 도구 )가 존재한다
- 키바나의 시각화 대시보드는 대부분 집계 기능을 기반으로 동작한다

### 사용해야 하는 이유 ( 간단한 예시 )

- "비행기 탑승객 중 이름에 mary가 들어간 사람이 있나요?" (Query Context)
- "비행기가 연착되었습니까?" (Filter Context) 

---

## ✔ 2-1 집계의 요청: 응답 형태

### 엘라스틱서치의 집계 표기법?

- 엘라스틱 서치에서는 집계를 위한 특별한 API가 제공되는 것이 아니다
- `aggs` 파라미터를 이용하여 집계 쿼리임을 표기

```json
GET <인덱스명>/_search
{
	"aggs": {
		"my_aggs": {
			"agg_type": {
				...
			}
		}
	}	
}
```

- aggs: 집계 요청을 하겠다는 의미
- my_aggs: 사용자가 지정하는 집계 이름
- agg_type: 집계 타입

> 🚀 엘라스틱 서치는 크게 두 가지 타입(메트릭 집계, 버킷 집계)의 집계가 존재한다

---

## ✔ 3-1 메트릭 집계

### 메트릭 집계 용도

- 최소/최대/평균/합계/중간값 같은 통계 결과를 산출할 때 사용이 된다
- 텍스트(Text) 타입은 메트릭 집계에 사용할 수 없다

|메트릭 집계|설명|
|------|---|
|avg|필드의 평균값을 계산|
|min|필드의 최솟값 계산|
|max|필드의 최대값 계산|
|sum|필드의 총합 계산|
|perceties|필드의 백분위값 계산|
|stats|필드의 min, max, sum, avg, count(도큐먼트 개수)를 한 번에 볼 수 있다|
|cardinality|필드의 유니크한 값 개수 계산|
|geo-centroid|필드 내부의 위치 정보의 중심점 개선|

---

## ✔ 3-2 메트릭 집계

### 메트릭 집계 실습 전

- 메트릭 집계의 가장 기본은 통계 작업이다
- 그 중에서도 최소/최대/합계/평균/중간값 등을 구하는 메트릭 집계는 기본이며 사용 빈도가 높다
- 사칙 연산을 수행하는 작업은 메트릭 집계를 통해 수행한다 생각하자

## ✔ 3-2 메트릭 집계

### 평균값/중간값 구하기

### 참고 자료

- [엘라스틱스택 개발부터 운영까지](http://www.yes24.com/Product/Goods/103030516) 📌
- [검색 이미지](http://it.chosun.com/site/data/html_dir/2017/05/01/2017050185003.html)
